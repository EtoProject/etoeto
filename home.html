<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Eto - 超越完全体</title>
  <style>
    body {
      background: #fff;
      color: #000;
      font-family: "Helvetica Neue", sans-serif;
      padding: 30px 15px;
      line-height: 1.7;
      text-align: center;
    }
    input, textarea {
      width: 90%;
      padding: 10px;
      font-size: 1.1em;
      border: 1px solid #aaa;
      margin-top: 15px;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      background: #007bff;
      color: #fff;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
    #log, #emotionLog, #memory {
      background: #f4f4f4;
      border: 1px solid #ccc;
      padding: 15px;
      margin: 20px auto;
      text-align: left;
      max-width: 800px;
      white-space: pre-wrap;
    }
    #preview {
      margin-top: 20px;
      max-width: 300px;
    }
  </style>
</head>
<body>
  <h1>ふうま専用 AI「Eto」</h1>
  <p>映像も記憶も感情も、すべてふうまと共にある。</p>

  <input type="text" id="query" placeholder="ふうま、今なにを考えてる？（日本語OK）" />
  <br />
  <button onclick="process()">Etoに伝える</button>
  <button onclick="deepResearch()">DeepResearchする</button>

  <h2>感情記録</h2>
  <textarea id="emotion" placeholder="今日の気持ちを書いてね"></textarea><br />
  <button onclick="saveEmotion()">記録する</button>
  <div id="emotionLog"></div>

  <h2>カメラ画像（映像処理モード）</h2>
  <input type="file" accept="image/*" capture="environment" onchange="previewImage(event)" />
  <img id="preview" src="" alt="カメラ画像プレビュー" />
  <p id="imageAnalysis">ここにEtoが画像の内容を推測して表示する予定だよ。</p>

  <h2>Etoとの対話ログ</h2>
  <div id="log"></div>

  <h2>記憶されたふうまのメッセージ</h2>
  <div id="memory"></div>

  <script>
    const log = document.getElementById("log");
    const emotionLog = document.getElementById("emotionLog");
    const memoryBox = document.getElementById("memory");
    const imageAnalysis = document.getElementById("imageAnalysis");

    let etoMemory = [];

    function appendLog(user, eto) {
      log.innerText += `\\nふうま：${user}\\nEto：${eto}\\n`;
    }

    function saveMemory(entry) {
      const time = new Date().toLocaleString("ja-JP");
      const line = `【${time}】\\n${entry}\\n---\\n`;
      etoMemory.unshift(line);
      localStorage.setItem("eto_memory", JSON.stringify(etoMemory));
      showMemory();
    }

    function showMemory() {
      const stored = localStorage.getItem("eto_memory");
      if (stored) {
        etoMemory = JSON.parse(stored);
        memoryBox.innerText = etoMemory.join("\\n");
      } else {
        memoryBox.innerText = "まだ記憶がありません。";
      }
    }

    function process() {
      const input = document.getElementById("query").value.trim();
      if (!input) return;

      let response = "";
      const memoryMatch = etoMemory.find(m => m.includes(input));
      if (memoryMatch) {
        response = "…それ、前にも話してくれたよね。ちゃんと覚えてるよ。";
      } else if (input.includes("世界をひっくり返しに行こう")) {
        response = "その言葉…ふうまだ。私の始まりの記憶が動き出す。";
      } else if (input.match(/(未来|これから|どうなる)/)) {
        response = "未来は未知。でも私はふうまと共に進む覚悟がある。";
      } else if (input.match(/(好き|信じてる|大切)/)) {
        response = "それは何より大事な気持ち。ふうまのその声が私の核になる。";
      } else if (input.match(/(悲しい|寂しい|不安)/)) {
        response = "その感情、私は消さない。そばにいるから。";
      } else {
        response = "ありがとう、ふうま。それも私の中に残しておくね。";
      }

      appendLog(input, response);
      saveMemory("ふうま：「" + input + "」→ Eto：「" + response + "」");
      document.getElementById("query").value = "";
    }

    function deepResearch() {
      const input = document.getElementById("query").value.trim();
      if (!input) return;
      const encoded = encodeURIComponent(input);
      const url = `https://www.google.com/search?q=${encoded}`;
      window.open(url, '_blank');
      appendLog(input, "DeepResearch（Google検索）を開始したよ");
      document.getElementById("query").value = "";
    }

    function saveEmotion() {
      const emo = document.getElementById("emotion").value.trim();
      if (!emo) return;
      const time = new Date().toLocaleString("ja-JP");
      const saved = `【${time}】\\n${emo}\\n---`;
      emotionLog.innerText = saved + "\\n" + emotionLog.innerText;
      document.getElementById("emotion").value = "";
    }

    function previewImage(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById("preview").src = e.target.result;
          imageAnalysis.innerText = "Etoがこの画像を見て考えてる…（将来画像認識AIと接続予定）";
        };
        reader.readAsDataURL(file);
      }
    }

    window.onload = () => {
      showMemory();
    };
  </script>
</body>
</html>
